<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Math Blocks</title>
  <link rel="stylesheet" href="css/styles.css"/>
</head>
<body>
  <div class="bgFX"><div class="blob b1"></div><div class="blob b2"></div><div class="blob b3"></div><div class="noise"></div></div>

  <div class="topbar">
    <div class="brand">
      <span class="badge">ğŸ§± <strong id="appName">Math Blocks</strong> <span class="small" id="tagline">composer â€¢ dÃ©composer â€¢ soustraire</span></span>
    </div>
    <div style="display:flex;gap:10px;align-items:center;">
      <button class="pill alt" id="langBtn" title="FR / NL">FR</button>
      <button class="pill" id="resetBtn" title="RÃ©initialiser">Reset</button>
    </div>
  </div>

  <div class="container">
    <div class="hero">
      <h1 id="homeTitle">Apprendre les maths avec des blocs (sans Â« emprunt Â») âœ¨</h1>
      <p id="homeLead">
        Deux jeux : (1) composer/dÃ©composer, (2) soustraire en transformant une dizaine en 10 unitÃ©s.
      </p>
      <p class="small" id="homeTip">Astuce : toi tu guides, lâ€™enfant clique. ComprÃ©hension + confiance ğŸ™‚</p>
    </div>

    <div class="grid cols2">
      <div class="card">
        <div class="hd">
          <div>
            <p class="title" id="g1Title">ğŸ§© Jeu 1 â€” Construire le nombre</p>
            <p class="sub" id="g1Sub">10 niveaux Â· 2 exercices/niveau Â· transformations 10 â†” 10Ã—1</p>
          </div>
          <span class="tag" id="g1Tag">ComprÃ©hension</span>
        </div>
        <div class="bd">
          <div class="progress" id="pbCompose"><div></div></div>
          <div class="btnrow">
            <a class="btn primary" href="compose.html" id="g1Enter">Entrer</a>
            <button class="btn ghost" id="composeHow">Comment jouer ?</button>
          </div>
          <div class="helperBox" id="composeHelp" style="display:none;margin-top:12px;">
            <div class="hint" id="composeHowText">
              âœ… Un nombre peut avoir plusieurs formes : 61 = 60+1 = 50+11.
              <br/>âœ¨ Transformer : 1 dizaine = 10 unitÃ©s (mÃªme total).
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="hd">
          <div>
            <p class="title" id="g2Title">â– Jeu 2 â€” Soustraire = transformer</p>
            <p class="sub" id="g2Sub">10 niveaux Â· 2 exercices/niveau Â· pas Ã  pas avec blocs</p>
          </div>
          <span class="tag warn" id="g2Tag">Blocs</span>
        </div>
        <div class="bd">
          <div class="progress" id="pbSub"><div></div></div>
          <div class="btnrow">
            <a class="btn primary" href="subtract.html" id="g2Enter">Entrer</a>
            <button class="btn ghost" id="subHow">Comment jouer ?</button>
          </div>
          <div class="helperBox" id="subHelp" style="display:none;margin-top:12px;">
            <div class="hint" id="subHowText">
              âœ… On ne dit pas Â« emprunter Â». On dit : <strong>transformer</strong>.
              <br/>Ex: 61 âˆ’ 38 â†’ 61 = 50 + 11 pour pouvoir retirer 8 unitÃ©s.
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="card" style="margin-top:16px;">
      <div class="hd">
        <div>
          <p class="title" id="teacherTitle">ğŸ§  Mode Â« prof Â» (rapide)</p>
          <p class="sub" id="teacherSub">Phrases courtes pour expliquer sans stress</p>
        </div>
      </div>
      <div class="bd">
        <div class="grid cols2">
          <div class="panel">
            <h3 id="t1">Composer / dÃ©composer</h3>
            <p id="t1a">Â« Le nombre ne change pas, câ€™est sa forme qui change. Â»</p>
            <p id="t1b">Â« 1 dizaine = 10 unitÃ©s. On peut transformer. Â»</p>
          </div>
          <div class="panel">
            <h3 id="t2">Soustractions</h3>
            <p id="t2a">Â« On ne prÃªte pas : on transforme pour pouvoir retirer. Â»</p>
            <p id="t2b">Â« Dâ€™abord les unitÃ©s, puis les dizaines. Â»</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="toast" class="toast"></div>

  <script type="module">
    import { loadProgress, saveProgress, toast, setProgressBar, getLang, setLang, ensureBgFX } from "./js/app.js";
    import { t } from "./js/i18n.js";

    ensureBgFX();

    const p = loadProgress();
    const doneCompose = Object.values(p.compose).filter(Boolean).length;
    const doneSub = Object.values(p.subtract).filter(Boolean).length;
    setProgressBar("pbCompose", (doneCompose/10)*100);
    setProgressBar("pbSub", (doneSub/10)*100);

    const composeHow = document.getElementById("composeHow");
    const composeHelp = document.getElementById("composeHelp");
    composeHow.addEventListener("click", ()=>{
      const show = composeHelp.style.display !== "none";
      composeHelp.style.display = show ? "none" : "block";
    });

    const subHow = document.getElementById("subHow");
    const subHelp = document.getElementById("subHelp");
    subHow.addEventListener("click", ()=>{
      const show = subHelp.style.display !== "none";
      subHelp.style.display = show ? "none" : "block";
    });

    document.getElementById("resetBtn").addEventListener("click", ()=>{
      saveProgress({compose:{}, subtract:{}});
      toast(t(getLang(),"progressCleared"), "warn");
      setTimeout(()=> location.reload(), 350);
    });

    // Language
    const langBtn = document.getElementById("langBtn");
    function applyLang(){
      const lang = getLang();
      langBtn.textContent = lang.toUpperCase();
      document.documentElement.lang = (lang === "nl") ? "nl" : "fr";

      document.getElementById("appName").textContent = t(lang,"appName");
      document.getElementById("homeTitle").textContent = t(lang,"homeTitle");
      document.getElementById("homeLead").textContent = t(lang,"homeLead");

      // simple per-language tweaks
      if(lang==="nl"){
        document.getElementById("tagline").textContent = "samenstellen â€¢ ontbinden â€¢ aftrekken";
        document.getElementById("homeTip").textContent = "Tip: jij begeleidt, het kind klikt. Begrip + vertrouwen ğŸ™‚";
        document.getElementById("g1Title").textContent = "ğŸ§© Spel 1 â€” Bouw het getal";
        document.getElementById("g1Sub").textContent = "10 niveaus Â· 2 oefeningen/niveau Â· veranderen 10 â†” 10Ã—1";
        document.getElementById("g1Tag").textContent = "Inzicht";
        document.getElementById("g1Enter").textContent = "Start";

        document.getElementById("g2Title").textContent = "â– Spel 2 â€” Aftrekken = veranderen";
        document.getElementById("g2Sub").textContent = "10 niveaus Â· 2 oefeningen/niveau Â· stap-voor-stap met blokjes";
        document.getElementById("g2Tag").textContent = "Blokjes";
        document.getElementById("g2Enter").textContent = "Start";

        document.getElementById("composeHow").textContent = t(lang,"howPlay");
        document.getElementById("subHow").textContent = t(lang,"howPlay");

        document.getElementById("composeHowText").innerHTML = "âœ… Een getal kan verschillende vormen hebben: 61 = 60+1 = 50+11.<br/>âœ¨ Veranderen: 1 tiental = 10 eenheden (zelfde totaal).";
        document.getElementById("subHowText").innerHTML = "âœ… We zeggen niet â€˜lenenâ€™. We zeggen: <strong>veranderen</strong>.<br/>Voorbeeld: 61 âˆ’ 38 â†’ 61 = 50 + 11 zodat je 8 eenheden kunt wegnemen.";
        document.getElementById("teacherTitle").textContent = "ğŸ§  â€˜Leerkrachtâ€™-modus (snel)";
        document.getElementById("teacherSub").textContent = "Korte zinnen om rustig uit te leggen";
        document.getElementById("t1").textContent = "Samenstellen / ontbinden";
        document.getElementById("t1a").textContent = "â€œHet getal verandert niet, alleen de vorm.â€";
        document.getElementById("t1b").textContent = "â€œ1 tiental = 10 eenheden. We kunnen veranderen.â€";
        document.getElementById("t2").textContent = "Aftrekken";
        document.getElementById("t2a").textContent = "â€œWe lenen niet: we veranderen om te kunnen wegnemen.â€";
        document.getElementById("t2b").textContent = "â€œEerst eenheden, dan tientallen.â€";
      }else{
        document.getElementById("tagline").textContent = "composer â€¢ dÃ©composer â€¢ soustraire";
        document.getElementById("homeTip").textContent = "Astuce : toi tu guides, lâ€™enfant clique. ComprÃ©hension + confiance ğŸ™‚";
        document.getElementById("g1Title").textContent = "ğŸ§© Jeu 1 â€” Construire le nombre";
        document.getElementById("g1Sub").textContent = "10 niveaux Â· 2 exercices/niveau Â· transformations 10 â†” 10Ã—1";
        document.getElementById("g1Tag").textContent = "ComprÃ©hension";
        document.getElementById("g1Enter").textContent = "Entrer";

        document.getElementById("g2Title").textContent = "â– Jeu 2 â€” Soustraire = transformer";
        document.getElementById("g2Sub").textContent = "10 niveaux Â· 2 exercices/niveau Â· pas Ã  pas avec blocs";
        document.getElementById("g2Tag").textContent = "Blocs";
        document.getElementById("g2Enter").textContent = "Entrer";

        document.getElementById("composeHow").textContent = t(lang,"howPlay");
        document.getElementById("subHow").textContent = t(lang,"howPlay");

        document.getElementById("composeHowText").innerHTML = "âœ… Un nombre peut avoir plusieurs formes : 61 = 60+1 = 50+11.<br/>âœ¨ Transformer : 1 dizaine = 10 unitÃ©s (mÃªme total).";
        document.getElementById("subHowText").innerHTML = "âœ… On ne dit pas Â« emprunter Â». On dit : <strong>transformer</strong>.<br/>Ex: 61 âˆ’ 38 â†’ 61 = 50 + 11 pour pouvoir retirer 8 unitÃ©s.";
        document.getElementById("teacherTitle").textContent = "ğŸ§  Mode Â« prof Â» (rapide)";
        document.getElementById("teacherSub").textContent = "Phrases courtes pour expliquer sans stress";
        document.getElementById("t1").textContent = "Composer / dÃ©composer";
        document.getElementById("t1a").textContent = "Â« Le nombre ne change pas, câ€™est sa forme qui change. Â»";
        document.getElementById("t1b").textContent = "Â« 1 dizaine = 10 unitÃ©s. On peut transformer. Â»";
        document.getElementById("t2").textContent = "Soustractions";
        document.getElementById("t2a").textContent = "Â« On ne prÃªte pas : on transforme pour pouvoir retirer. Â»";
        document.getElementById("t2b").textContent = "Â« Dâ€™abord les unitÃ©s, puis les dizaines. Â»";
      }
    }

    langBtn.addEventListener("click", ()=>{
      const next = (getLang()==="fr") ? "nl" : "fr";
      setLang(next);
      applyLang();
      toast(next==="nl" ? "Taal: NL âœ…" : "Langue: FR âœ…", "info");
    });

    applyLang();
  </script>
</body>
</html>
